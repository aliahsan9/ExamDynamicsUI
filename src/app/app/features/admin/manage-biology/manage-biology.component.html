<div class="container mt-4">
  <h2 class="mb-3">Manage Biology Questions</h2>

  <!-- ====== Question Form ====== -->
  <form [formGroup]="questionForm" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label for="topicId" class="form-label">Topic ID</label>
      <input type="number" id="topicId" class="form-control" formControlName="topicId" min="1">
    </div>

    <div class="mb-3">
      <label for="text" class="form-label">Question Text</label>
      <textarea id="text" class="form-control" formControlName="text" rows="2"></textarea>
    </div>

    <div class="mb-3">
      <label for="questionType" class="form-label">Question Type</label>
      <select id="questionType" class="form-select" formControlName="questionType">
        <option value="MCQ">MCQ</option>
        <option value="Short">Short Answer</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="correctAnswer" class="form-label">Correct Answer</label>
      <input type="text" id="correctAnswer" class="form-control" formControlName="correctAnswer">
    </div>

    <!-- ====== Options ====== -->
    <div formArrayName="options">
      <div *ngFor="let opt of options.controls; let i = index" [formGroupName]="i" class="mb-2 d-flex align-items-center">
        <input type="text" class="form-control me-2" placeholder="Option Text" formControlName="text">
        <div class="form-check me-2">
          <input type="checkbox" class="form-check-input" formControlName="isCorrect" id="optionCheck{{i}}">
          <label class="form-check-label" [for]="'optionCheck' + i">Correct</label>
        </div>
        <button type="button" class="btn btn-danger btn-sm" (click)="removeOption(i)" [disabled]="options.length === 1">Remove</button>
      </div>
    </div>

    <button type="button" class="btn btn-secondary btn-sm mb-3" (click)="addOption()">Add Option</button>

    <div class="text-end">
      <button type="submit" class="btn btn-success me-2" [disabled]="questionForm.invalid">
        {{ isEditing ? 'Update Question' : 'Add Question' }}
      </button>
      <button type="button" class="btn btn-outline-secondary" (click)="resetForm()">Clear</button>
    </div>
  </form>

  <hr>

  <!-- ====== Questions List ====== -->
  <h4 class="mt-4">Existing Biology Questions</h4>
  <div *ngIf="biologyQuestions.length === 0" class="text-muted">No questions found.</div>
  <div class="list-group">
    <div *ngFor="let question of biologyQuestions" class="list-group-item">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <strong>Q{{ question.questionId }}:</strong> {{ question.text }}
          <div class="mt-1">
            <small>Correct Answer: {{ question.correctAnswer }}</small>
          </div>
          <div class="mt-1">
            <small>Options:</small>
            <ul class="mb-0">
              <li *ngFor="let opt of optionsMap[question.questionId]">
                {{ opt.text }} <span *ngIf="opt.isCorrect" class="badge bg-success">âœ”</span>
              </li>
            </ul>
          </div>
        </div>
        <div>
          <button class="btn btn-primary btn-sm me-1" (click)="editQuestion(question)">Edit</button>
          <button class="btn btn-danger btn-sm" (click)="deleteQuestion(question.questionId)">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>
