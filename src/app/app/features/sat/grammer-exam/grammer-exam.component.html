<div class="container py-5" data-aos="fade-up">
  <h2 class="text-center mb-4 fw-bold text-primary">
    ✍️ Grammar Exam
  </h2>

  <!-- Progress Bar -->
  <div class="progress mb-4" *ngIf="questions.length > 0 && !submitted">
    <div
      class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
      role="progressbar"
      [style.width.%]="progress"
      [attr.aria-valuenow]="progress"
      aria-valuemin="0"
      aria-valuemax="100"
    >
      {{ progress | number : '1.0-0' }}%
    </div>
  </div>

  <form *ngIf="questions.length > 0; else loading">
    <div
      *ngFor="let q of questions; let i = index"
      class="card shadow-sm mb-4 quiz-card"
      data-aos="zoom-in"
    >
      <div class="card-body">
        <h5 class="card-title">
          {{ i + 1 }}. {{ q.text }}
        </h5>

        <div *ngFor="let opt of optionsMap[q.questionId]" class="form-check my-2">
          <input
            class="form-check-input"
            type="radio"
            [name]="'q' + q.questionId"
            [value]="opt.text"
            [(ngModel)]="userAnswers[q.questionId]"
            (change)="updateProgress()"
            [disabled]="submitted"
          />
          <label class="form-check-label">{{ opt.text }}</label>

          <!-- Show correct/incorrect after submit -->
          <span *ngIf="submitted && opt.text === q.correctAnswer" class="text-success ms-2">
            <i class="bi bi-check-circle-fill"></i> Correct
          </span>
          <span
            *ngIf="
              submitted &&
              userAnswers[q.questionId] === opt.text &&
              opt.text !== q.correctAnswer
            "
            class="text-danger ms-2"
          >
            <i class="bi bi-x-circle-fill"></i> Your Answer
          </span>
        </div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="text-center mt-4">
      <button
        type="button"
        class="btn btn-primary px-4 me-2"
        (click)="submitQuiz()"
        [disabled]="submitted"
      >
        <i class="bi bi-check2-circle"></i> Submit
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary px-4"
        (click)="resetQuiz()"
        *ngIf="submitted"
      >
        <i class="bi bi-arrow-repeat"></i> Try Again
      </button>
    </div>

    <!-- Score -->
    <div *ngIf="submitted" class="alert alert-info mt-4 text-center" data-aos="fade-in">
      <h5 class="mb-0">Your Score: {{ score }} / {{ questions.length }}</h5>
    </div>
  </form>

  <ng-template #loading>
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Loading Grammar questions...</p>
    </div>
  </ng-template>
</div>
