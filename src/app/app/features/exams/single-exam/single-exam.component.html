<div class="container mt-4">
  <h2 class="mb-4 text-primary">Exam MCQs</h2>

  <!-- Progress bar -->
  <div class="progress mb-4">
    <div
      class="progress-bar bg-success"
      role="progressbar"
      [style.width.%]="progress"
    >
      {{ progress | number: '1.0-0' }}%
    </div>
  </div>

  <!-- Result Screen -->
  <div *ngIf="submitted; else quizContent" class="card p-4 shadow-sm">
    <h4 class="text-success text-center">ðŸŽ‰ Exam Completed!</h4>
    <p class="mt-3 fs-5 text-center">
      Your Score: <b>{{ score }}</b> / {{ questions.length }}
      ({{ (score / questions.length * 100) | number:'1.0-0' }}%)
    </p>

    <hr />

    <!-- Review Section -->
    <div *ngFor="let q of questions; let i = index" class="mb-4">
      <h6>Q{{ i + 1 }}. {{ q.text }}</h6>

      <!-- User Selected Answer -->
      <p>
        Your Answer:
        <span
          [ngClass]="{
            'text-success': selectedAnswers[q.questionId] === q.correctAnswer,
            'text-danger': selectedAnswers[q.questionId] !== q.correctAnswer
          }"
        >
          {{ selectedAnswers[q.questionId] || 'Not Attempted' }}
        </span>
      </p>

      <!-- Buttons -->
      <button
        class="btn btn-outline-success btn-sm me-2"
        (click)="toggleAnswer(q.questionId)"
      >
        {{ showAnswer[q.questionId] ? 'Hide Answer' : 'Show Answer' }}
      </button>

      <button
        class="btn btn-outline-info btn-sm"
        (click)="toggleExplanation(q.questionId)"
      >
        {{ showExplanation[q.questionId] ? 'Hide Explanation' : 'Show Explanation' }}
      </button>

      <!-- Correct Answer -->
      <div *ngIf="showAnswer[q.questionId]" class="alert alert-success mt-2">
        âœ… Correct Answer: {{ q.correctAnswer }}
      </div>

      <!-- Explanation -->
      <div *ngIf="showExplanation[q.questionId]" class="alert alert-info mt-2">
        ðŸ’¡ Explanation: {{ q.explanation }}
      </div>

      <hr />
    </div>
  </div>

  <!-- Quiz Content -->
  <ng-template #quizContent>
    <div *ngIf="questions.length; else noQuestions" class="card p-4 shadow-sm">
      <h5>
        Q{{ currentIndex + 1 }}. {{ questions[currentIndex].text }}
      </h5>

      <!-- Options -->
      <ul class="list-group mt-3">
        <li
          *ngFor="let opt of optionsMap[questions[currentIndex].questionId]"
          class="list-group-item"
        >
          <label class="d-flex align-items-center">
            <input
              type="radio"
              class="form-check-input me-2"
              name="q{{ questions[currentIndex].questionId }}"
              [value]="opt.text"
              [(ngModel)]="selectedAnswers[questions[currentIndex].questionId]"
            />
            {{ opt.text }}
          </label>
        </li>
      </ul>

      <!-- Answer & Explanation buttons -->
      <div class="mt-3">
        <button
          class="btn btn-outline-success btn-sm me-2"
          (click)="toggleAnswer(questions[currentIndex].questionId)"
        >
          {{ showAnswer[questions[currentIndex].questionId] ? 'Hide Answer' : 'Show Answer' }}
        </button>

        <button
          class="btn btn-outline-info btn-sm"
          (click)="toggleExplanation(questions[currentIndex].questionId)"
        >
          {{ showExplanation[questions[currentIndex].questionId] ? 'Hide Explanation' : 'Show Explanation' }}
        </button>
      </div>

      <!-- Correct Answer -->
      <div
        *ngIf="showAnswer[questions[currentIndex].questionId]"
        class="alert alert-success mt-2"
      >
        âœ… Correct Answer: {{ questions[currentIndex].correctAnswer }}
      </div>

      <!-- Explanation -->
      <div
        *ngIf="showExplanation[questions[currentIndex].questionId]"
        class="alert alert-info mt-2"
      >
        ðŸ’¡ Explanation: {{ questions[currentIndex].explanation }}
      </div>

      <!-- Navigation -->
      <div class="d-flex justify-content-between mt-4">
        <button
          class="btn btn-secondary"
          [disabled]="currentIndex === 0"
          (click)="prevQuestion()"
        >
          Previous
        </button>

        <button
          class="btn btn-primary"
          [disabled]="currentIndex === questions.length - 1"
          (click)="nextQuestion()"
        >
          Next
        </button>
      </div>

      <!-- Submit Button -->
      <div class="text-center mt-4">
        <button class="btn btn-success px-4" (click)="submitExam()">
          Submit Exam
        </button>
      </div>
    </div>
  </ng-template>

  <!-- No Questions -->
  <ng-template #noQuestions>
    <div class="alert alert-warning">
      No questions available for this exam.
    </div>
  </ng-template>
</div>
  