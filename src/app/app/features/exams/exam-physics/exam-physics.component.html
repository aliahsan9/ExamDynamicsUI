<div class="exam-container container py-4">
  <h2 class="text-center mb-4 fw-bold">Physics Exam</h2>

  <!-- Progress Bar -->
  <div *ngIf="physicsQuestions.length > 0 && !submitted" class="mb-4">
    <label class="form-label">
      Progress: {{ answeredCount() }} / {{ physicsQuestions.length }} answered
    </label>
    <div class="progress" style="height: 25px;">
      <div class="progress-bar bg-info"
           role="progressbar"
           [style.width.%]="(answeredCount()/physicsQuestions.length)*100"
           [attr.aria-valuenow]="answeredCount()"
           [attr.aria-valuemin]="0"
           [attr.aria-valuemax]="physicsQuestions.length">
        {{ ((answeredCount()/physicsQuestions.length)*100) | number:'1.0-0' }}%
      </div>
    </div>
  </div>

  <!-- Exam Form -->
  <form *ngIf="!submitted">
    <div *ngFor="let q of physicsQuestions; let i = index"
         class="mb-4 p-3 border rounded shadow-sm question-card"
         data-aos="fade-up">
      <h5>
        <span class="badge bg-primary me-2">{{ i + 1 }}</span>
        {{ q.text }}
      </h5>

      <div *ngFor="let opt of optionsMap[q.questionId]" class="form-check my-2">
        <input class="form-check-input"
               type="radio"
               [name]="'question' + q.questionId"
               [value]="opt.text"
               [(ngModel)]="userAnswers[q.questionId]"
               (change)="selectAnswer(q.questionId, opt.text)"
               [id]="'q' + q.questionId + '_opt' + opt.optionId" />
        <label class="form-check-label" [for]="'q' + q.questionId + '_opt' + opt.optionId">
          {{ opt.text }}
        </label>
      </div>
    </div>

    <div class="text-center">
      <button type="button" class="btn btn-success btn-lg px-5" (click)="submitExam()">Submit Exam</button>
    </div>
  </form>

  <!-- Result Section -->
  <div *ngIf="submitted" class="mt-4">
    <h3 class="text-center mb-4">
      Your Score: <span class="text-success">{{ score }}</span> / {{ physicsQuestions.length }}
    </h3>

    <div *ngFor="let q of physicsQuestions; let i = index"
         class="card mb-3 border-success"
         data-aos="fade-up">
      <div class="card-body">
        <h5 class="card-title">
          <span class="badge bg-primary me-2">{{ i + 1 }}</span> {{ q.text }}
        </h5>
        <p>Your Answer: 
          <span [ngClass]="{
            'text-success': userAnswers[q.questionId] === q.correctAnswer,
            'text-danger': userAnswers[q.questionId] !== q.correctAnswer
          }">
            {{ userAnswers[q.questionId] || 'No Answer' }}
          </span>
        </p>
        <p>Correct Answer: <span class="text-success">{{ q.correctAnswer }}</span></p>
      </div>
    </div>

    <!-- Restart Button -->
    <div class="text-center mt-4">
      <button class="btn btn-secondary btn-lg px-5" (click)="resetExam()">Restart Exam</button>
    </div>
  </div>
</div>
